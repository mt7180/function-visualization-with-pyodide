<!doctype html>
<html lang="de">
    <head>
        <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
        <link href="https://fonts.googleapis.com/css2?family=Ephesis&display=swap" rel="stylesheet">
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx" crossorigin="anonymous">
        </script>
        
        <title>Function Visualization</title>
        <meta charset="utf-8">
        <link href="styles.css" rel="stylesheet">
        <script src="https://cdn.jsdelivr.net/pyodide/dev/full/pyodide.js"></script> </head>
    </head>
    <!-- <script src="https://cdn.jsdelivr.net/pyodide/v0.19.0/full/pyodide.js"></script> -->
       
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            let inp = document.querySelector('input');
            inp.addEventListener('keyup', function(event) {
                var name = document.querySelector('#name');
                if (inp.value) {
                    name.innerHTML = `Your function: ${inp.value}`;
                }
                else {
                    name.innerHTML = 'Hello, whoever you are';
                }
            })
        })
    </script>
    <body>
        <div class="jumbotron jumbotron-fluid">
            <h1 class="display-4">Function Visualizer</h1>
                <p class="lead">Type your function and it will be displayed</p>
        </div>
        <div class="jumbotron jumbotron-fluid" style="background-color: #fff; color: black">
            <form >
                <input autocomplete="off" placeholder="Put in a function" type="text" >
            </form>
            <br>
            <p id="name" class="lead"></p>
            <script type="text/javascript">
                async function main(){
                    let pyodide = await loadPyodide();
                    console.log(
                        pyodide.runPython(`
                            import sys
                            sys.version
                        `)
                    );
                    
                    await pyodide.loadPackage("matplotlib", "sympy", "base64");

                    // Fetch parse_fctn.py and save it in browser memory
                    await pyodide.runPythonAsync(`
                        from pyodide.http import pyfetch
                        response = await pyfetch("src/test.py")
                        with open("test.py", "wb") as f:
                            f.write(await response.bytes())
                    `)


                    // Importing fetched .py module
                    let pkg = pyodide.pyimport("test")
                    const ls = pkg.test();
                    //const ls = pkg.parse_function("x^3+4");
                    //pyodide.runPython(await (await fetch("src/parse_ftctn.py")).text());
                    
                    //const ls = pyodide.runPython(`pkg.parse_function("x^3+4")["latex_function"] `);
                    //img_str = sol["figure"]
                    

                    //document.getElementById("pyplotfigure").src=pyodide.globals.get("img_str");
                    document.getElementById("latex_function").innerHTML =ls;
                    
                }
                main(); 
            </script>
            
            <p id="latex_function" class="lead"></p>
            <div id="pyplotdiv"><img id="pyplotfigure"/></div>
        </div>

    </body>
</html>